{% extends 'base.html' %}
{% from "/components/error-summary/macro.html" import tnaErrorSummary %}
{% set pageTitle = feedback_form.name|truncate(13, true) %}
{% block content %}
  <div class="tna-section">
    <div class="tna-container">
      <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">
        {% if messages %}
          {% set ns = namespace(error_messages=[]) %}
          {% for message in messages %}
            {% set ns.error_messages = ns.error_messages + [{"text": message|string}] %}
          {% endfor %}
          {{ tnaErrorSummary({
            "title": "There is a problem",
            "headingLevel": 2,
            "items": ns.error_messages,
            "disableAutoFocus": true
          }) }}
        {% endif %}
        <hgroup class="tna-hgroup-xl">
          <p class="tna-hgroup__supertitle">Feedback form</p>
          <h1 class="tna-hgroup__title">{{ feedback_form.name|wordwrap(25) }}</h1>
        </hgroup>
        <dl class="tna-dl tna-dl--plain">
          <dt>Status</dt>
          <dd>
            {% if feedback_form.disabled_at %}
              Draft
            {% else %}
              Published
            {% endif %}
          </dd>
          {% if not feedback_form.is_enabled() %}
            <dt>Unpublished by</dt>
            <dd>
                {{ feedback_form.disabled_by }}
            </dd>
            <dt>Unpublished on</dt>
            <dd>
                {{ feedback_form.disabled_at|date() }}
            </dd>
          {% endif %}
          <dt>ID</dt>
          <dd>
            {{ feedback_form.uuid }}
          </dd>
          <dt>Created</dt>
          <dd>
            {{ feedback_form.created_at|date("d M Y") }}
          </dd>
          <dt>Project</dt>
          <dd>
            <a href="{{ url("editor_ui:projects:detail", project_uuid) }}">{{ feedback_form.project }}</a>
          </dd>
        </dl>
        <div class="tna-button-group">
        {% if user_project_permissions.is_member %}
            <a href="{{ url("editor_ui:projects:feedback_forms:update", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid) }}"
               class="tna-button"
               data-testing-id="edit-feedback-form-button">Edit feedback form details</a>
            <a href="{{ url("editor_ui:projects:feedback_forms:delete", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid) }}"
               class="tna-button"
               data-testing-id="delete-feedback-form-button">Delete feedback form</a>
          {% endif %}
        </div>
      </div>
      <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny tna-!--padding-top-xl">
        <hgroup class="tna-hgroup-m">
          <h2 class="tna-hgroup__title">Path patterns</h2>
        </hgroup>
        <p class="tna-body">Define the paths that should trigger this feedback form.</p>
        {% if path_patterns %}
          <div class="tna-table-wrapper tna-!--margin-top-s tna-!--margin-bottom-m">
            <table class="tna-table">
              <thead class="tna-table__head">
                <tr class="tna-table__row">
                  <th class="tna-table__header">Pattern</th>
                  <th class="tna-table__header">Created by</th>
                  <th class="tna-table__header"></th>
                </tr>
              </thead>
              <tbody class="tna-table__body">
                {% for path in path_patterns %}
                  <tr class="tna-table__row">
                    <th class="tna-table__header">
                      {{ path }}
                    </th>
                    <td class="tna-table__cell">{{ path.created_by }}</td>
                    <td class="tna-table__cell tna-table__cell--button">
                      <a href="{{ url("editor_ui:projects:feedback_forms:path_patterns:update", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid, path_pattern_uuid=path.uuid) }}" class="tna-button tna-button--plain">Edit</a>
                      <a href="{{ url("editor_ui:projects:feedback_forms:path_patterns:delete", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid, path_pattern_uuid=path.uuid) }}" class="tna-button tna-button--plain">Delete</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>No path patterns</p>
        {% endif %}
        <div class="tna-button-group">
          <a href="{{ url("editor_ui:projects:feedback_forms:path_patterns:create", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid) }}"
             class="tna-button"
             aria-label="Create a path pattern"
             title="Create a path pattern">
            <i class="fa-solid fa-plus" aria-hidden="true"></i>
            Create a path pattern
          </a>
        </div>
      </div>
      <div class="tna-column tna-column--full tna-!--padding-top-xl">
        <hgroup class="tna-hgroup-m">
          <h2 class="tna-hgroup__title">Prompts</h2>
        </hgroup>
        <p class="tna-body">Define the prompts for this feedback form.</p>
        {% if prompts %}
          <div class="tna-table-wrapper tna-!--margin-top-s tna-!--margin-bottom-m">
            <table class="tna-table">
              <thead class="tna-table__head">
                <tr class="tna-table__row">
                  <th class="tna-table__header tna-column--width-1-3">Text</th>
                  <th class="tna-table__header">Prompt Type</th>
                  <th class="tna-table__header tna-table__header--numeric">Order</th>
                  <th class="tna-table__header">Status</th>
                  <th class="tna-table__header">Created by</th>
                  <th class="tna-table__header"></th>
                </tr>
              </thead>
              <tbody class="tna-table__body">
                {% for prompt in prompts %}
                  <tr class="tna-table__row">
                    <th class="tna-table__cell">
                      <a href="{{ url("editor_ui:projects:feedback_forms:prompts:detail", project_uuid, feedback_form.uuid, prompt.uuid) }}">{{ prompt.text|wordwrap(25) }}</a>
                    </th>
                    <td class="tna-table__cell">{{ prompt.field_label }}</td>
                    <td class="tna-table__cell tna-table__cell--numeric">{{ prompt.order }}</td>
                    <td class="tna-table__cell">
                      {% if prompt.is_enabled() %}
                        Published
                      {% else %}
                        Draft
                      {% endif %}
                    </td>
                    <td class="tna-table__cell">{{ prompt.created_by }}</td>
                    <td class="tna-table__cell tna-table__cell--button">
                      <a href="{{ url('editor_ui:projects:feedback_forms:prompts:update', project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid, prompt_uuid=prompt.uuid) }}"
                       class="tna-button tna-button--plain"
                       data-testing-id="edit-button">Edit</a>
                      <a href="{{ url('editor_ui:projects:feedback_forms:prompts:delete', project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid, prompt_uuid=prompt.uuid) }}"
                       class="tna-button tna-button--plain"
                       data-testing-id="edit-button">Delete</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>No prompts</p>
        {% endif %}
        <div class="tna-button-group">
          <a href="{{ url("editor_ui:projects:feedback_forms:prompts:create", project_uuid=project_uuid, feedback_form_uuid=feedback_form.uuid) }}"
             class="tna-button"
             class="tna-button"
             aria-label="Create a prompt"
             title="Create a prompt">
            <i class="fa-solid fa-plus" aria-hidden="true"></i>
            Create a prompt
          </a>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
